#!/bin/bash
# agent-notify - Send desktop notification for agent events
# Usage: agent-notify [title] [message]
# Used by tmux hooks for agent alerts

TITLE="${1:-Agent Tmux}"
MESSAGE="${2:-Agent needs attention}"
SOUND="${3:-}"  # Optional sound (macOS only)

# Check if notifications are disabled
if [ -n "$AGENT_NOTIFY_DISABLED" ] || [ -f "$HOME/.agent-notify-disabled" ]; then
    exit 0
fi

# macOS
if command -v osascript &>/dev/null; then
    if [ -n "$SOUND" ]; then
        osascript -e "display notification \"$MESSAGE\" with title \"$TITLE\" sound name \"$SOUND\""
    else
        osascript -e "display notification \"$MESSAGE\" with title \"$TITLE\""
    fi
    exit 0
fi

# Linux (notify-send)
if command -v notify-send &>/dev/null; then
    notify-send "$TITLE" "$MESSAGE" --urgency=normal
    exit 0
fi

# Linux (zenity fallback)
if command -v zenity &>/dev/null; then
    zenity --notification --text="$TITLE: $MESSAGE" &
    exit 0
fi

# WSL (PowerShell toast)
if command -v powershell.exe &>/dev/null; then
    powershell.exe -Command "[Windows.UI.Notifications.ToastNotificationManager, Windows.UI.Notifications, ContentType = WindowsRuntime] | Out-Null; \$template = [Windows.UI.Notifications.ToastNotificationManager]::GetTemplateContent([Windows.UI.Notifications.ToastTemplateType]::ToastText02); \$template.SelectSingleNode('//text[@id=\"1\"]').InnerText = '$TITLE'; \$template.SelectSingleNode('//text[@id=\"2\"]').InnerText = '$MESSAGE'; [Windows.UI.Notifications.ToastNotificationManager]::CreateToastNotifier('Agent Tmux').Show([Windows.UI.Notifications.ToastNotification]::new(\$template))" 2>/dev/null
    exit 0
fi

# No notification system available - silent exit
exit 0
