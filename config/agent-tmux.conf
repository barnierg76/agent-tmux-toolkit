# agent-tmux.conf - tmux config for parallel AI agents
# Add to your ~/.tmux.conf or source this file

# === BASICS ===
set -g mouse on
set -g history-limit 50000
set -g base-index 1
setw -g pane-base-index 1

# Show pane titles in border (role prefix + dynamic title from AI agent)
set -g pane-border-status top
set -g pane-border-format " #{?@role,#{@role}: ,}#{pane_title} "

# === COPY/PASTE (the important part) ===
# Use vi mode for copy
setw -g mode-keys vi

# Enter copy mode with Prefix + v
bind v copy-mode

# In copy mode: v to start selection, y to yank
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# Prefix + p to paste
bind p paste-buffer

# === MOUSE COPY (pane-aware, copies to system clipboard) ===
# Mouse drag: select within pane only, copy to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "pbcopy"

# Double-click: select word and copy to clipboard
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send -X select-word \; send -X copy-pipe-and-cancel "pbcopy"

# Triple-click: select line and copy to clipboard
bind -T copy-mode-vi TripleClick1Pane select-pane \; send -X select-line \; send -X copy-pipe-and-cancel "pbcopy"

# Quick copy last output: Prefix + C
# (enters copy mode and selects the last command output)
bind C copy-mode \; send -X start-of-line \; send -X search-backward "â¯\\|\\$\\|>" \; send -X search-again \; send -X start-of-line \; send -X select-line

# === PANE NAVIGATION ===
# Quick jump to specific pane: Meta + 1/2/3
bind -n M-1 select-pane -t 1
bind -n M-2 select-pane -t 2
bind -n M-3 select-pane -t 3

# Arrow keys for pane navigation (since M-hjkl used for workflow)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# === PANE MANAGEMENT ===
# Zoom current pane: Prefix + z (default, but noting it)
# bind z resize-pane -Z

# Swap panes
bind -n M-< swap-pane -U
bind -n M-> swap-pane -D

# === TEXT EDITING HELPERS ===
# Option+Backspace: clear entire line (sends Ctrl+U)
bind -n M-BSpace send-keys C-u

# Option+Delete: clear word backwards (sends Ctrl+W)
bind -n M-DC send-keys C-w

# === SNIPPET PICKER (pane-aware) ===
# Meta+s: open snippet picker popup (shows relevant snippets for current pane)
bind -n M-s display-popup -w 60% -h 60% -E "~/.local/bin/snippet-picker"

# Meta+Space: alternative binding for snippet picker
bind -n M-Space display-popup -w 60% -h 60% -E "~/.local/bin/snippet-picker"

# === AGENT MANAGER ===
# Meta+m: open agent-manage popup (sessions, panes, actions)
bind -n M-m display-popup -w 70% -h 70% -E "~/.local/bin/agent-manage"

# === SEND TO OTHER PANES ===
# Prefix + 1/2/3 then type: send keys to specific pane
bind 1 select-pane -t 1
bind 2 select-pane -t 2
bind 3 select-pane -t 3

# Prefix + s: sync input to all panes (toggle)
bind s setw synchronize-panes \; display "Sync #{?pane_synchronized,ON,OFF}"

# === QUICK ACTIONS ===
# Prefix + r: reload config
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# Prefix + S: save pane history to file
bind S command-prompt -p "Save to:" "capture-pane -S -50000 ; save-buffer %1"

# === STYLING (optional, adjust to taste) ===
set -g status-style bg=default,fg=white
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour39
set -g status-left "#[fg=green]#S "
set -g status-right "#[fg=yellow]%H:%M"

# === ACTIVITY MONITORING (optional) ===
# Uncomment to enable activity/silence monitoring
# set -g monitor-activity on
# set -g monitor-silence 30

# === AGENT STATUS ===
# Meta+d: show agent status dashboard
bind -n M-d display-popup -w 80% -h 70% -E "~/.local/bin/agent-status"

# === COMPOUND WORKFLOW ===
# Meta+f: workflow flow orchestrator (PLAN -> WORK -> REVIEW -> COMPOUND)
bind -n M-f display-popup -w 50% -h 60% -E "~/.local/bin/agent-flow"

# Meta+h: handoff context between panes
bind -n M-h display-popup -w 60% -h 50% -E "~/.local/bin/agent-handoff"

# === HELP ===
# Meta+?: show help popup
bind -n M-? display-popup -w 70 -h 30 -E "~/.local/bin/agent-help"

# === WORKFLOW LIFECYCLE HOOKS ===
# Prompt for compound when detaching if workflow active
set-hook -g client-detached 'run-shell "~/.local/bin/agent-flow-prompt detach 2>/dev/null || true"'

# === IMPORTANT FOR MAC ===
# For Option/Meta to work, set in iTerm2:
# Preferences > Profiles > Keys > Left/Right Option Key > Esc+
